(function(n,t,i){function f(n,t,i){for(var f=0,e=0,o=null,r=null,s=done=function(){f===n.length&&(clearInterval(o),i&&i())};e<n.length;e++)r=n[e],r.height=parseInt(r.height),r.width=parseInt(r.width),r.height>=0&&r.width>=0?++f:function(n){u(n[t],function(t,i){n.width=t,n.height=i,++f},null,function(){n.width=208,n.height=240,n.imgSrc="/Images/default.jpg",++f})}(r);o=setInterval(done,40)}function e(n,t){clearTimeout(n.tid),t=t||null,n.tid=setTimeout(function(){n.call(t)},100)}function r(n){for(var u=n.slice(),i=[],e=n.length,r,f,t=0;t<e;t++)i[t]=t;for(t=0;t<e;t++)for(r=t;r<e;r++)u[r]<u[t]&&(f=u[t],u[t]=u[r],u[r]=f,f=i[t],i[t]=i[r],i[r]=f);return n.minHeight=n[i[0]],n.maxHeight=n[i[i.length-1]],i}n.fn.waterfall=function(u){function d(){nt||g||s.minHeight+b<n(t).height()+n(t).scrollTop()&&(y.length>0?ut():o.ajaxTimes==="infinite"||it<o.ajaxTimes?(w("loading"),o.params.ajax=++it,et(function(t){try{typeof t=="string"&&(t=n.parseJSON(t)),n.isEmptyObject(t)||typeof t=="string"?w("finish"):(y=y.concat(t).reverse(),ut())}catch(i){w("error")}},function(){w("error")})):w("finish"))}function ut(){var l=typeof o.perNum=="number"?o.perNum:o.colNum,t=null,v=h.height(),i,u,e;f(y,o.imgUrlName,function(){while(l-->0&&(t=y.pop()))c=r(s)[0],k=c*(o.colWidth+o.marginLeft),a=s[c]+o.marginTop,e=ot(t),i=n("<div>").addClass(o.itemClass).html(e).css({width:o.colWidth,left:k,top:a}).appendTo(h),u=i.find("."+o.imgClass),u.height(u.width()/t.width*t.height),o.isAnimation&&i.css({opacity:0}).animate({opacity:1},800),s[c]=a+i.outerHeight(),s[c]>s.maxHeight&&(s.maxHeight=s[c]),h.height(s.maxHeight);g=!1,p.hide(),d()})}function ft(){var t=0,i=0,u=0,f=0;if(t=Math.floor((l.width()+o.marginLeft)/(o.colWidth+o.marginLeft)),t>0&&t!==o.colNum){for(o.colNum=t,h.width((o.colWidth+o.marginLeft)*o.colNum-o.marginLeft),i=0;i<o.colNum;i++)s[i]=0;s.length=o.colNum,rt=h.children(".wf_item"),rt.each(function(){c=r(s)[0],a=s[c]+o.marginTop,k=c*(o.colWidth+o.marginLeft),o.isAnimation&&(f=300),n(this).width(o.colWidth).animate({left:k,top:a},f),s[c]=a+n(this).outerHeight()}),r(s),h.height(s.maxHeight),d()}u=h.offset().left+(h.width()+l.width())/2-v.width()+80,st(v[0],{left:u,bottom:0})}function w(n){switch(n){case"loading":g=!0,p.html("").addClass("wf_loading").show();break;case"error":p.removeClass("wf_loading").show().html("数据格式错误，请返回标准的Json数据或Json格式字符串！"),nt=!0;break;case"finish":p.removeClass("wf_loading").show().html("已加载完毕，没有更多了！"),nt=!0}}var o=n.extend({},n.fn.waterfall.defaults,u),tt=!-[1,]&&!t.XMLHttpRequest,it=0,g=!1,nt=!1,s=[],c=0,y=[],b=0,a=0,k=0,l,h,rt,p,v,et=n.isFunction(o.ajaxFunc)?o.ajaxFunc:function(t,i){n.ajax({type:"GET",url:o.url,cache:!1,data:o.params,dataType:"json",timeout:6e4,success:t,error:i})},ot=n.isFunction(o.createHtml)?o.createHtml:function(n){return'<div class="wf_item_inner"><a href="'+n.href+'" class="thumb" target="_blank"><img class="'+o.imgClass+'"  src="'+n.imgSrc+'" /><\/a><h3 class="title"><a href="'+n.href+'" target="_blank">'+n.title+'<\/a><\/h3><p class="desc">'+n.describe+"<\/p><\/div>"},st=function(){var n=i.getElementsByTagName("html")[0],u=i.documentElement,t=i.body,r=u||t;return tt&&t.currentStyle.backgroundAttachment!=="fixed"&&(n.style.backgroundImage="url(about:blank)",n.style.backgroundAttachment="fixed"),tt?function(n,t){var i=n.style,u="(document.documentElement || document.body)";typeof t.left!="number"&&(t.left=r.clientWidth-t.right-n.offsetWidth),typeof t.top!="number"&&(t.top=r.clientHeight-t.bottom-n.offsetHeight),n.style.position="absolute",i.removeExpression("left"),i.removeExpression("top"),i.setExpression("left","eval("+u+".scrollLeft + "+t.left+') + "px"'),i.setExpression("top","eval("+u+".scrollTop + "+t.top+') + "px"')}:function(n,t){var i=n.style;i.position="fixed",typeof t.left=="number"?i.left=t.left+"px":(i.left="auto",i.right=t.right+"px"),typeof t.top=="number"?i.top=t.top+"px":(i.top="auto",i.bottom=t.bottom+"px")}}();return this.each(function(){if(n(this).data("_wf_is_done_"))return!0;l=n(this).addClass("waterfall").data("_wf_is_done_",!0),b=l.offset().top,h=l.children(".wf_col"),h.length===0&&(h=n("<div>").addClass("wf_col").appendTo(l)),p=n("<div>").addClass("wf_result").appendTo(l),v=n("<a><\/a>").attr("id","backTop").attr("title","返回照片顶部").appendTo(i.body),v.css("opacity",0).bind("click",function(){n("body,html").stop(!0).animate({scrollTop:b},500)}),n(i.body).css("overflow","scroll"),ft(),n(i.body).css("overflow","auto"),d(),n(t).bind("scroll",function(){n(t).scrollTop()>b?v.stop(!0).animate({opacity:1},500):v.stop(!0).animate({opacity:0},500),d()}).bind("resize",function(){e(ft)})})},n.fn.waterfall.defaults={itemClass:"wf_item",imgClass:"thumb_img",colWidth:235,marginLeft:15,marginTop:15,perNum:"auto",isAnimation:!0,ajaxTimes:"infinite",imgUrlName:"imgSrc",params:{},url:"",ajaxFunc:null,createHtml:null};var u=function(){var n=[],t=null,i=function(){for(var t=0;t<n.length;t++)n[t].end?n.splice(t--,1):n[t]();n.length||r()},r=function(){clearInterval(t),t=null};return function(r,u,f,e){var s,l,a,h,c,o=new Image;if(!r){e&&e();return}if(o.src=r,o.complete){u(o.width,o.height),f&&f(o.width,o.height);return}l=o.width,a=o.height,s=function(){h=o.width,c=o.height,(h!==l||c!==a||h*c>1024)&&(u(h,c),s.end=!0)},s(),o.onerror=function(){e&&e(),s.end=!0,o=o.onload=o.onerror=null},o.onload=function(){f&&f(o.width,o.height),s.end||s(),o=o.onload=o.onerror=null},s.end||(n.push(s),t===null&&(t=setInterval(i,40)))}}()})(jQuery,window,document);
//@ sourceMappingURL=jquery.waterfall.min.js.map