(function(n){var t={init:function(i){var r=this,c={getCommentsUrl:null,postCommentUrl:null,deleteCommentUrl:null,localization:{headerText:"Comments",commentPlaceHolderText:"Add a comment...",sendButtonText:"Send",replayButtonText:"Replay",deleteButtonText:"Delete"},callback:{beforDelete:function(){return!0},afterDelete:function(){},beforCommentAdd:function(){return!0},afterCommentAdd:function(){},beforRefresh:function(){},afterRefresh:function(){}},displayHeader:!0,displayCount:!0,loadWhenVisible:!1,readOnly:!1,displayAvatar:!1},o,u,f;if((i=n.extend(!0,{},c,i),this.data("data",{options:i}),this.addClass("commentsBlock"),i.displayHeader)&&(o="<div class='heading'><h4>"+i.localization.headerText,i.displayCount&&(o+=' (<span data-action="count"><\/span>) '),o+="<\/h4> <div class='loadingIndicator'><\/div><div class=\"clearFix\"><\/div><\/div>",this.append(o)),i.readOnly||this.append('<div class="newComment"><form enctype="multipart/form-data"><textarea placeholder="'+i.localization.commentPlaceHolderText+'" name="comment" maxlength="150"><\/textarea><a href="javascript:void(0)" class="btn sendComment" data-action="send"><span>'+i.localization.sendButtonText+"<\/span><\/a><\/form><\/div>"),this.append('<ul class="comments"><\/ul>'),u=this.find(".newComment").find("textarea"),f=u.parent().find("[data-action='send']"),f.hide(),u.focusout(function(){0==n.trim(n(this).val()).length&&(f.hide(),n(this).val(""))}),u.focus(function(){f.show()}),f.bind("click",function(){var e=n(this).parents("form"),o=u.val(),i;n.trim(o).length>0&&(i=e.serialize(),t.postComment.call(r,i),u.val(""),f.hide())}),i.loadWhenVisible){var s=r.offset().top,h=s+r.height(),e=n(window).scrollTop();e+n(window).height()>=h&&s>=e?t.refresh.call(r):n(window).bind("scroll",function(){e=n(window).scrollTop(),e+n(window).height()>=h&&s>=e&&(n(window).unbind("scroll"),t.refresh.call(r))})}else t.refresh.call(r)},count:function(){var n=this;return n.find(".comment").length},refresh:function(){var i=this,u=i.find(".loadingIndicator"),r;u.show(),r=this.data().data.options,r.callback.beforRefresh(),n.getJSON(this.data().data.options.getCommentsUrl,function(f){i.find(".comments").empty(),n.each(f,function(n,r){t.bindComment.call(i,r)}),t.bindEvents.call(i),u.hide(),i.find(".heading h4 [data-action='count']").html(i.find(".comment").length),r.callback.afterRefresh()})},postComment:function(i){var r=this,u=r.data().data.options,f;u.callback.beforCommentAdd()&&(f=r.find(".loadingIndicator"),f.show(),n.post(u.postCommentUrl,i,function(n){f.hide(),t.bindComment.call(r,n),t.bindEvents.call(r),r.find(".heading h4 [data-action='count']").html(r.find(".comment").length),u.callback.afterCommentAdd(n.Id)}))},bindComment:function(n){var i,r=this.data().data.options,t;null!=n.ParentId?(i=this.find("[data-commentid="+n.ParentId+"]"),0==i.find(".reply_comments").length&&i.append("<div class='reply_comments'><ul class='comments'><\/ul><\/div>"),i=i.children(".reply_comments").children(".comments")):i=this.children(".comments"),null!=n.Comment&&(n.Comment=n.Comment.replace("<script>","").replace("<\/script>","")),t="<li class='comment' data-commentId='"+n.Id+'\'><div class="commentContent">',r.displayAvatar?(t+='<div class="avatar">',t+=null!=n.UserAvatar?'<img src="'+n.UserAvatar+'" />':'<div class="defaultAvatar"><\/div>',t+='<\/div><div class="content avatarPadding">'):t+='<div class="content">',t+="<p class='info'><span class='author'><a href=\"/"+n.Author+'">'+n.Author+"<\/a><\/span><\/p><p class='commentText'>"+n.Comment+"<\/p><p class='info'><time>"+n.Date+"<\/time>",r.readOnly||("boolean"!=typeof n.CanReplay||n.CanReplay)&&(t+="<a href='javascript:void(0)' data-action='replay'>"+r.localization.replayButtonText+"<\/a>"),!r.readOnly&&"boolean"==typeof n.CanDelete&&n.CanDelete&&(t+="<a href='javascript:void(0)' data-action='delete'>"+r.localization.deleteButtonText+"<\/a>"),t+="<\/p><\/div><\/div><\/li>",i.prepend(t)},bindEvents:function(){var i=this,r=i.data().data.options;n('[data-action="replay"]').unbind().bind("click",function(){t.startCommentReplay.call(i,n(this))}),n('[data-action="delete"]').unbind().bind("click",function(){if(r.callback.beforDelete(n(this).parents("li.comment").data("commentid"))){var t=i.find(".loadingIndicator");t.show(),n.post(r.deleteCommentUrl,{commentId:n(this).parents("li.comment").data("commentid")},function(u){n("[data-commentid="+u+"]").remove(),i.find(".heading h4 [data-action='count']").html(i.find(".comment").length),t.hide(),r.callback.afterDelete(u)})}})},startCommentReplay:function(i){var e=this,f=this.data().data.options,r=n(i).parents("li.comment"),u;n(i).parent().after("<div class='contentBlockCommentAdd'><form enctype='multipart/form-data'><textarea cols='20' placeholder='"+f.localization.commentPlaceHolderText+"' rows='2' name='comment' maxlength='150'><\/textarea><a href='javascript:void(0)' class='btn sendComment' data-action='send'><span>"+f.localization.sendButtonText+"<\/span><\/a><\/form><\/div>"),n(i).hide(),u=n(r).find("textarea"),u.focus(),u.focusout(function(){n(this).removeClass("focused"),0==n.trim(n(this).val()).length&&(r.find(".contentBlockCommentAdd").remove(),n(this).val(""),n(i.show()))}),r.find('[data-action="send"]').bind("click",function(){var f=n(this).parent(),o=f.find("textarea").val(),u;0!=n.trim(o).length&&(u=f.serialize(),u+="&parentId="+r.data("commentid"),t.postComment.call(e,u)),n(i.show()),r.find(".contentBlockCommentAdd").remove()})}};n.fn.comments=function(i){return t[i]?t[i].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof i&&i?(n.error("Method "+i+" doesn not exists in jQuery.comments"),null):t.init.apply(this,arguments)}})(jQuery);
//@ sourceMappingURL=jquery.comment.min.js.map